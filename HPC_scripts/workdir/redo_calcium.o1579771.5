Original path: /rds/general/user/be320/projects/thefarm2/live/Firefly/Calcium_Voltage_Imaging/MDA_MB_468/20250127/slip3/20250127_slip3_area1_468/20250127_slip3_area1_exp3ms_4AP_5mM_1
Fixed path: /rds/general/user/ys5320/projects/thefarm2/live/Firefly/Calcium_Voltage_Imaging/MDA_MB_468/20250127/slip3/20250127_slip3_area1_468/20250127_slip3_area1_exp3ms_4AP_5mM_1
4 0
4 1
4 2
4 3
20250226_slip3_area1
['20250226_slip3_area1_TRAM-34_1uM_1_MMStack_Default.ome.tif', '20250226_slip3_area1_TRAM-34_1uM_1_MMStack_Default_1.ome.tif', '20250226_slip3_area1_TRAM-34_1uM_1_MMStack_Default_2.ome.tif']
Loaded Z-stack shape: (20000, 512, 512)
(10000, 512, 512) (10000, 512, 512)
(10000, 512, 512) (10000, 512, 512)
✅ Saved enhanced_voltage_video.avi at 1000 FPS in /rds/general/user/ys5320/home/firefly_link/Calcium_Voltage_Imaging/MDA_MB_468/analysis/results_pipeline/20250226_slip3_area1
✅ Saved enhanced_calcium_video.avi at 1000 FPS in /rds/general/user/ys5320/home/firefly_link/Calcium_Voltage_Imaging/MDA_MB_468/analysis/results_pipeline/20250226_slip3_area1
4 5
4 6
4 7
4 8
4 9
4 10
4 11
4 12
4 13
4 14
4 15
4 16
4 17
4 18
4 19
4 20
4 21
4 22
4 23
4 24
4 25
4 26
4 27
4 28
4 29
4 30
4 31
4 32
4 33
4 34
4 35
4 36
4 37
4 38
4 39
4 40
4 41
4 42
4 43
4 44
4 45
4 46
4 47
4 48
4 49
4 50
4 51
4 52
4 53
4 54
4 55
4 56
4 57
4 58
4 59
4 60
4 61
4 62
4 63
4 64
4 65
4 66
4 67
4 68
4 0
4 1
4 2
4 3

Processing pipeline for trial: 20250226_slip3_area1
Processing trial: 20250226_slip3_area1
Voltage file: 20250226_slip3_area1_TRAM-34_1uM_voltage_transfected.csv
Calcium file: 20250226_slip3_area1_TRAM-34_1uM_ca_transfected.csv
--------------------------------------------------------------------------------
Loading voltage and calcium data...
Detected: full_experiment with 10000 datapoints
Detected: full_experiment with 10000 datapoints
Voltage cells: 28, Calcium cells: 28
=== FULL EXPERIMENT - USING SEGMENTATION ===
=== STEP 1: Normalization + High-Pass Filter to Full VOLTAGE Timeseries ===
Applying normalization to raw voltage data (before filtering)...
  - Min-max normalization applied to voltage (range: [-1, 1])
Applying high-pass filter to normalized voltage data (cutoff: 0.01 Hz)...
Normalization + High-pass filtering complete for voltage. Shape: (28, 10000)
=== STEP 1: Normalization + High-Pass Filter to Full CALCIUM Timeseries ===
Applying normalization to raw calcium data (before filtering)...
  - Min-max normalization applied to calcium (range: [-1, 1])
Applying high-pass filter to normalized calcium data (cutoff: 0.01 Hz)...
Normalization + High-pass filtering complete for calcium. Shape: (28, 10000)
=== STEP 2: Finding Consensus Timepoint from VOLTAGE data ===

=== Detection Consistency Analysis ===

Detection Consistency Analysis:
Total detections: 26
Time range: 15.22 - 18.22 min
Time span: 3.00 min
Standard deviation: 0.612 min
Median: 16.76 min

Detection time distribution (30-second bins):
  15.2-15.7 min: 3 detections
  15.7-16.2 min: 1 detections
  16.2-16.7 min: 9 detections
  16.7-17.2 min: 12 detections
  17.7-18.2 min: 1 detections

=== Consensus Timepoint (MODE) ===
Found 26 total detections across channels
Detection times: ['16.70 min', '16.70 min', '16.70 min', '16.97 min', '16.71 min', '16.71 min', '16.89 min', '16.71 min', '17.01 min', '16.99 min', '16.71 min', '17.21 min', '17.08 min', '17.02 min', '16.95 min', '16.93 min', '16.81 min', '16.71 min', '17.02 min', '15.44 min', '16.92 min', '16.06 min', '15.22 min', '15.22 min', '16.71 min', '18.22 min']
Consensus method: Mode group size = 20, time = 16.85 min

Consensus timepoint: 16.85 min (sample 5054)
Assigned consensus timepoint to all 28 channels
=== CREATING SEGMENT VIDEOS FOR 20250226_slip3_area1 ===
  Using TIFF files: ['20250226_slip3_area1_TRAM-34_1uM_1_MMStack_Default.ome.tif', '20250226_slip3_area1_TRAM-34_1uM_1_MMStack_Default_1.ome.tif', '20250226_slip3_area1_TRAM-34_1uM_1_MMStack_Default_2.ome.tif']
  Loaded Z-stack shape: (20000, 512, 512)
  Deinterleaved shapes: V=(10000, 512, 512), Ca=(10000, 512, 512)
  Creating pre segment: frames 200-4854
✅ Saved pre_voltage_20250226_slip3_area1.avi at 1000 FPS in /rds/general/user/ys5320/home/firefly_link/Calcium_Voltage_Imaging/MDA_MB_468/analysis/results_profiles/20250226_slip3_area1
✅ Saved pre_calcium_20250226_slip3_area1.avi at 1000 FPS in /rds/general/user/ys5320/home/firefly_link/Calcium_Voltage_Imaging/MDA_MB_468/analysis/results_profiles/20250226_slip3_area1
  ✓ Created: pre_voltage_20250226_slip3_area1.avi & pre_calcium_20250226_slip3_area1.avi
  Creating post segment: frames 5454-9999
✅ Saved post_voltage_20250226_slip3_area1.avi at 1000 FPS in /rds/general/user/ys5320/home/firefly_link/Calcium_Voltage_Imaging/MDA_MB_468/analysis/results_profiles/20250226_slip3_area1
✅ Saved post_calcium_20250226_slip3_area1.avi at 1000 FPS in /rds/general/user/ys5320/home/firefly_link/Calcium_Voltage_Imaging/MDA_MB_468/analysis/results_profiles/20250226_slip3_area1
  ✓ Created: post_voltage_20250226_slip3_area1.avi & post_calcium_20250226_slip3_area1.avi
=== STEP 3: Segmenting High-Pass Filtered VOLTAGE Timeseries ===
Consensus timepoint: 5054 frames (16.85 min)
VOLTAGE PRE segment: frames 200-4854 (0.67-16.18 min)
  Shape: (28, 4655)
VOLTAGE POST segment: frames 5454-9999 (18.18-33.33 min)
  Shape: (28, 4546)
=== STEP 3: Segmenting High-Pass Filtered CALCIUM Timeseries ===
Consensus timepoint: 5054 frames (16.85 min)
CALCIUM PRE segment: frames 200-4854 (0.67-16.18 min)
  Shape: (28, 4655)
CALCIUM POST segment: frames 5454-9999 (18.18-33.33 min)
  Shape: (28, 4546)

=== PROCESSING VOLTAGE PRE SEGMENT ===
  - voltage Gaussian filtering applied (sigma=3)
  Voltage data saved with original cell IDs to: /rds/general/user/ys5320/home/firefly_link/Calcium_Voltage_Imaging/MDA_MB_468/analysis/results_profiles/20250226_slip3_area1/pre_voltage_TRAM-34_1uM_20250226_slip3_area1.csv
  Voltage RAW data saved to: /rds/general/user/ys5320/home/firefly_link/Calcium_Voltage_Imaging/MDA_MB_468/analysis/results_profiles/20250226_slip3_area1/pre_voltage_TRAM-34_1uM_20250226_slip3_area1_raw.csv

=== PROCESSING CALCIUM PRE SEGMENT ===
  - calcium Gaussian filtering applied (sigma=3)
  Calcium data saved with original cell IDs to: /rds/general/user/ys5320/home/firefly_link/Calcium_Voltage_Imaging/MDA_MB_468/analysis/results_profiles/20250226_slip3_area1/pre_calcium_TRAM-34_1uM_20250226_slip3_area1.csv
  Calcium RAW data saved to: /rds/general/user/ys5320/home/firefly_link/Calcium_Voltage_Imaging/MDA_MB_468/analysis/results_profiles/20250226_slip3_area1/pre_calcium_TRAM-34_1uM_20250226_slip3_area1_raw.csv

=== PROCESSING VOLTAGE POST SEGMENT ===
  - voltage Gaussian filtering applied (sigma=3)
  Voltage data saved with original cell IDs to: /rds/general/user/ys5320/home/firefly_link/Calcium_Voltage_Imaging/MDA_MB_468/analysis/results_profiles/20250226_slip3_area1/post_voltage_TRAM-34_1uM_20250226_slip3_area1.csv
  Voltage RAW data saved to: /rds/general/user/ys5320/home/firefly_link/Calcium_Voltage_Imaging/MDA_MB_468/analysis/results_profiles/20250226_slip3_area1/post_voltage_TRAM-34_1uM_20250226_slip3_area1_raw.csv

=== PROCESSING CALCIUM POST SEGMENT ===
  - calcium Gaussian filtering applied (sigma=3)
  Calcium data saved with original cell IDs to: /rds/general/user/ys5320/home/firefly_link/Calcium_Voltage_Imaging/MDA_MB_468/analysis/results_profiles/20250226_slip3_area1/post_calcium_TRAM-34_1uM_20250226_slip3_area1.csv
  Calcium RAW data saved to: /rds/general/user/ys5320/home/firefly_link/Calcium_Voltage_Imaging/MDA_MB_468/analysis/results_profiles/20250226_slip3_area1/post_calcium_TRAM-34_1uM_20250226_slip3_area1_raw.csv

=== VOLTAGE EVENT DETECTION ===
Using FIXED STD voltage event detection
Min duration: 6.5s, Threshold: 2.5σ
  Using provided fixed std: 0.0600
  Fixed threshold for all channels: ±0.1500
  Using per-channel median baselines with fixed STD threshold
Detecting voltage events using fixed_std approach...
  - Applying full morphological filtering for voltage channel 0
  - Applying full morphological filtering for voltage channel 1
  - Applying full morphological filtering for voltage channel 2
  - Applying full morphological filtering for voltage channel 3
  - Applying full morphological filtering for voltage channel 4
  - Applying full morphological filtering for voltage channel 5
  - Applying full morphological filtering for voltage channel 6
  - Applying full morphological filtering for voltage channel 7
  - Applying full morphological filtering for voltage channel 8
  - Applying full morphological filtering for voltage channel 9
  - Applying full morphological filtering for voltage channel 10
  - Applying full morphological filtering for voltage channel 11
  - Applying full morphological filtering for voltage channel 12
  - Applying full morphological filtering for voltage channel 13
  - Applying full morphological filtering for voltage channel 14
  - Applying full morphological filtering for voltage channel 15
  - Applying full morphological filtering for voltage channel 16
  - Applying full morphological filtering for voltage channel 17
  - Applying full morphological filtering for voltage channel 18
  - Applying full morphological filtering for voltage channel 19
  - Applying full morphological filtering for voltage channel 20
  - Applying full morphological filtering for voltage channel 21
  - Applying full morphological filtering for voltage channel 22
  - Applying full morphological filtering for voltage channel 23
  - Applying full morphological filtering for voltage channel 24
  - Applying full morphological filtering for voltage channel 25
  - Applying full morphological filtering for voltage channel 26
  - Applying full morphological filtering for voltage channel 27
Detected 115 voltage events using fixed_std (fixed=0.0600)
  Removed 3 duplicate voltage events

=== FILTERING BLEACHING ARTIFACTS: VOLTAGE PRE SEGMENT ===
Filtering bleaching artifacts for voltage (≥5 cells, 70% overlap, start <10.0s)...
  Original voltage events: 112
  Excluded bleaching artifacts: 0
  Remaining voltage events: 112

=== FILTERING SIMULTANEOUS EVENTS: VOLTAGE PRE SEGMENT ===
Filtering simultaneous voltage events (max 999 cells, 50% overlap)...
  Original voltage events: 112
  Filtered voltage events: 112
  Excluded voltage events: 0
FIXED: Using per-channel baselines + fixed STD threshold for voltage visualization...
  Fixed voltage std: 0.0600
  Fixed voltage threshold: ±0.1500
  Using per-channel baselines (as in detection)
  FIXED voltage plot saved to: /rds/general/user/ys5320/home/firefly_link/Calcium_Voltage_Imaging/MDA_MB_468/analysis/results_profiles/event_detection_plots/pre_voltage_TRAM-34_1uM_20250226_slip3_area1_events_perchannel_fixed.png
Using FIXED STD voltage event detection
Min duration: 6.5s, Threshold: 2.5σ
  Using provided fixed std: 0.0600
  Fixed threshold for all channels: ±0.1500
  Using per-channel median baselines with fixed STD threshold
Detecting voltage events using fixed_std approach...
  - Applying full morphological filtering for voltage channel 0
  - Applying full morphological filtering for voltage channel 1
  - Applying full morphological filtering for voltage channel 2
  - Applying full morphological filtering for voltage channel 3
  - Applying full morphological filtering for voltage channel 4
  - Applying full morphological filtering for voltage channel 5
  - Applying full morphological filtering for voltage channel 6
  - Applying full morphological filtering for voltage channel 7
  - Applying full morphological filtering for voltage channel 8
  - Applying full morphological filtering for voltage channel 9
  - Applying full morphological filtering for voltage channel 10
  - Applying full morphological filtering for voltage channel 11
  - Applying full morphological filtering for voltage channel 12
  - Applying full morphological filtering for voltage channel 13
  - Applying full morphological filtering for voltage channel 14
  - Applying full morphological filtering for voltage channel 15
  - Applying full morphological filtering for voltage channel 16
  - Applying full morphological filtering for voltage channel 17
  - Applying full morphological filtering for voltage channel 18
  - Applying full morphological filtering for voltage channel 19
  - Applying full morphological filtering for voltage channel 20
  - Applying full morphological filtering for voltage channel 21
  - Applying full morphological filtering for voltage channel 22
  - Applying full morphological filtering for voltage channel 23
  - Applying full morphological filtering for voltage channel 24
  - Applying full morphological filtering for voltage channel 25
  - Applying full morphological filtering for voltage channel 26
  - Applying full morphological filtering for voltage channel 27
Detected 88 voltage events using fixed_std (fixed=0.0600)
  Removed 1 duplicate voltage events

=== FILTERING BLEACHING ARTIFACTS: VOLTAGE POST SEGMENT ===
Filtering bleaching artifacts for voltage (≥5 cells, 70% overlap, start <10.0s)...
  Found 5 positive bleaching events (cells: [7, 27, 23, 9, 8], times: 0.0-1.4s)
  Original voltage events: 87
  Excluded bleaching artifacts: 5
  Remaining voltage events: 82

=== FILTERING SIMULTANEOUS EVENTS: VOLTAGE POST SEGMENT ===
Filtering simultaneous voltage events (max 999 cells, 50% overlap)...
  Original voltage events: 82
  Filtered voltage events: 82
  Excluded voltage events: 0
FIXED: Using per-channel baselines + fixed STD threshold for voltage visualization...
  Fixed voltage std: 0.0600
  Fixed voltage threshold: ±0.1500
  Using per-channel baselines (as in detection)
  FIXED voltage plot saved to: /rds/general/user/ys5320/home/firefly_link/Calcium_Voltage_Imaging/MDA_MB_468/analysis/results_profiles/event_detection_plots/post_voltage_TRAM-34_1uM_20250226_slip3_area1_events_perchannel_fixed.png
Enhanced filtered voltage events saved to: /rds/general/user/ys5320/home/firefly_link/Calcium_Voltage_Imaging/MDA_MB_468/analysis/results_profiles/20250226_slip3_area1/events_voltage_TRAM-34_1uM_20250226_slip3_area1_fixed_std_adaptive_filtered.csv

FIXED STD VOLTAGE Event Summary for TRAM-34_1uM 20250226_slip3_area1:
  Total filtered events: 194
  Total excluded events: 5 (50% rule)
  Pre-segment events: 112
  Post-segment events: 82
  Duration stats: mean=28.41s, median=28.40s

=== CALCIUM EVENT DETECTION ===
Using FIXED STD calcium event detection
Min duration: 6.5s, Threshold: 2.5σ
  Using provided fixed std: 0.0600
  Fixed threshold for all channels: ±0.1500
  Using per-channel median baselines with fixed STD threshold
Detecting calcium events using fixed_std approach...
  - Applying full morphological filtering for voltage channel 0
  - Applying full morphological filtering for voltage channel 1
  - Applying full morphological filtering for voltage channel 2
  - Applying full morphological filtering for voltage channel 3
  - Applying full morphological filtering for voltage channel 4
  - Applying full morphological filtering for voltage channel 5
  - Applying full morphological filtering for voltage channel 6
  - Applying full morphological filtering for voltage channel 7
  - Applying full morphological filtering for voltage channel 8
  - Applying full morphological filtering for voltage channel 9
  - Applying full morphological filtering for voltage channel 10
  - Applying full morphological filtering for voltage channel 11
  - Applying full morphological filtering for voltage channel 12
  - Applying full morphological filtering for voltage channel 13
  - Applying full morphological filtering for voltage channel 14
  - Applying full morphological filtering for voltage channel 15
  - Applying full morphological filtering for voltage channel 16
  - Applying full morphological filtering for voltage channel 17
  - Applying full morphological filtering for voltage channel 18
  - Applying full morphological filtering for voltage channel 19
  - Applying full morphological filtering for voltage channel 20
  - Applying full morphological filtering for voltage channel 21
  - Applying full morphological filtering for voltage channel 22
  - Applying full morphological filtering for voltage channel 23
  - Applying full morphological filtering for voltage channel 24
  - Applying full morphological filtering for voltage channel 25
  - Applying full morphological filtering for voltage channel 26
  - Applying full morphological filtering for voltage channel 27
Detected 143 calcium events using fixed_std (fixed=0.0600)
  Removed 7 duplicate calcium events

=== FILTERING BLEACHING ARTIFACTS: CALCIUM PRE SEGMENT ===
Filtering bleaching artifacts for calcium (≥5 cells, 70% overlap, start <10.0s)...
  Original calcium events: 136
  Excluded bleaching artifacts: 0
  Remaining calcium events: 136

=== FILTERING SIMULTANEOUS EVENTS: CALCIUM PRE SEGMENT ===
Filtering simultaneous calcium events (max 999 cells, 50% overlap)...
  Original calcium events: 136
  Filtered calcium events: 136
  Excluded calcium events: 0
FIXED: Using per-channel baselines + fixed STD threshold for calcium visualization...
  Fixed calcium std: 0.0600
  Fixed calcium threshold: ±0.1500
  Using per-channel baselines (as in detection)
  FIXED calcium plot saved to: /rds/general/user/ys5320/home/firefly_link/Calcium_Voltage_Imaging/MDA_MB_468/analysis/results_profiles/event_detection_plots/pre_calcium_TRAM-34_1uM_20250226_slip3_area1_events_perchannel_fixed.png
Using FIXED STD calcium event detection
Min duration: 6.5s, Threshold: 2.5σ
  Using provided fixed std: 0.0600
  Fixed threshold for all channels: ±0.1500
  Using per-channel median baselines with fixed STD threshold
Detecting calcium events using fixed_std approach...
  - Applying full morphological filtering for voltage channel 0
  - Applying full morphological filtering for voltage channel 1
  - Applying full morphological filtering for voltage channel 2
  - Applying full morphological filtering for voltage channel 3
  - Applying full morphological filtering for voltage channel 4
  - Applying full morphological filtering for voltage channel 5
  - Applying full morphological filtering for voltage channel 6
  - Applying full morphological filtering for voltage channel 7
  - Applying full morphological filtering for voltage channel 8
  - Applying full morphological filtering for voltage channel 9
  - Applying full morphological filtering for voltage channel 10
  - Applying full morphological filtering for voltage channel 11
  - Applying full morphological filtering for voltage channel 12
  - Applying full morphological filtering for voltage channel 13
  - Applying full morphological filtering for voltage channel 14
  - Applying full morphological filtering for voltage channel 15
  - Applying full morphological filtering for voltage channel 16
  - Applying full morphological filtering for voltage channel 17
  - Applying full morphological filtering for voltage channel 18
  - Applying full morphological filtering for voltage channel 19
  - Applying full morphological filtering for voltage channel 20
  - Applying full morphological filtering for voltage channel 21
  - Applying full morphological filtering for voltage channel 22
  - Applying full morphological filtering for voltage channel 23
  - Applying full morphological filtering for voltage channel 24
  - Applying full morphological filtering for voltage channel 25
  - Applying full morphological filtering for voltage channel 26
  - Applying full morphological filtering for voltage channel 27
Detected 107 calcium events using fixed_std (fixed=0.0600)
  Removed 1 duplicate calcium events

=== FILTERING BLEACHING ARTIFACTS: CALCIUM POST SEGMENT ===
Filtering bleaching artifacts for calcium (≥5 cells, 70% overlap, start <10.0s)...
  Found 7 positive bleaching events (cells: [4, 25, 23, 22, 12, 11, 9], times: 0.0-0.0s)
  Original calcium events: 106
  Excluded bleaching artifacts: 7
  Remaining calcium events: 99

=== FILTERING SIMULTANEOUS EVENTS: CALCIUM POST SEGMENT ===
Filtering simultaneous calcium events (max 999 cells, 50% overlap)...
  Original calcium events: 99
  Filtered calcium events: 99
  Excluded calcium events: 0
FIXED: Using per-channel baselines + fixed STD threshold for calcium visualization...
  Fixed calcium std: 0.0600
  Fixed calcium threshold: ±0.1500
  Using per-channel baselines (as in detection)
  FIXED calcium plot saved to: /rds/general/user/ys5320/home/firefly_link/Calcium_Voltage_Imaging/MDA_MB_468/analysis/results_profiles/event_detection_plots/post_calcium_TRAM-34_1uM_20250226_slip3_area1_events_perchannel_fixed.png
Enhanced filtered calcium events saved to: /rds/general/user/ys5320/home/firefly_link/Calcium_Voltage_Imaging/MDA_MB_468/analysis/results_profiles/20250226_slip3_area1/events_calcium_TRAM-34_1uM_20250226_slip3_area1_fixed_std_adaptive_filtered.csv

FIXED STD CALCIUM Event Summary for TRAM-34_1uM 20250226_slip3_area1:
  Total filtered events: 235
  Total excluded events: 7 (50% rule)
  Pre-segment events: 136
  Post-segment events: 99
  Duration stats: mean=22.70s, median=20.80s
✓ Pipeline completed for 20250226_slip3_area1
4 5
4 6
4 7
4 8
4 9
4 10
4 11
4 12
4 13
4 14
4 15
4 16
4 17
4 18
4 19
4 20
4 21
4 22
4 23
4 24
4 25
4 26
4 27
4 28
4 29
4 30
4 31
4 32
4 33
4 34
4 35
4 36
4 37
4 38
4 39
4 40
4 41
4 42
4 43
4 44
4 45
4 46
4 47
4 48
4 49
4 50
4 51
4 52
4 53
4 54
4 55
4 56
4 57
4 58
4 59
4 60
4 61
4 62
4 63
4 64
4 65
4 66
4 67
4 68

============================================

        Job resource usage summary 

                 Memory (GB)    NCPUs
 Requested  :        64            32
 Used       :        18 (peak)  22.04 (ave)

============================================
